#!/usr/bin/env bash
set -euo pipefail

TEST=$1
AVAILABILITY_ZONE=$2
DU_DIR=$3
LOG_DIR=$4
test -n "$DU_DIR"
test -d "$LOG_DIR"


#TODO LOAD TEST CONF
echo "LOAD TEST CONF"


docker run \
  --rm \
  --network host \
  --env-file $DU_DIR/$ENVIRONMENT.testvars \
  --env K8S_ENVIRONMENT=$ENVIRONMENT \
  --env K8S_DEPLOYMENT_ID=$K8S_DEPLOYMENT_ID \
  --env K8S_LOAD_BALANCER=$GREEN_LOAD_BALANCER \
  vasdvp/exemplar-test:latest \
  $TEST \
  | tee $LOG_DIR/$TEST-$AVAILABILITY_ZONE.log
