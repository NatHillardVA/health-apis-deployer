#!/usr/bin/env bash
set -euo pipefail

test -n "$DU_DIR"
test -n "$DU_S3_FOLDER"
test -n "$DU_AWS_BUCKET"

fetch-deployment-unit $DU_ARTIFACT $DU_VERSION
extract-deployment-unit deployment-unit.tar.gz $DU_DIR $DU_DECRYPTION_KEY
validate-deployment-unit $DU_DIR
perform-substitution $DU_DIR
validate-yaml $DU_DIR/deployment.yaml $DU_NAMESPACE
bucket-beaver push-properties --folder-name "$DU_S3_FOLDER" --bucket-name "$DU_AWS_BUCKET" --du-directory "$DU_DIR"
