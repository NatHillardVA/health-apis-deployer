#!/usr/bin/env bash
set -euo pipefail

onExit() {
  if [ -f $NAMESPACE_YAML ]; then rm $NAMESPACE_YAML; fi
}
trap onExit EXIT

DU_DIR=$1
test -n "$DU_DIR"

NAMESPACE_YAML=$(mktemp ns-XXXX.yaml)
cat $WORKSPACE/products/$PRODUCT.yaml | envsubst > $NAMESPACE_YAML
echo "Deleting namespace $DU_NAMESPACE"
cluster-fox kubectl $AVAILABILITY_ZONE -- delete namespace $DU_NAMESPACE
echo "Creating namespace $DU_NAMESPACE"
cluster-fox kubectl $AVAILABILITY_ZONE -- apply -f $NAMESPACE_YAML
