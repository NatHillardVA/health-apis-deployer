# -*- sh -*-
set -euo pipefail

_init() {
  PLUGIN_NAME=$(basename $0 | sed 's/[0-9]\+-//')
  PLUGIN_PRIORITY=100 # lower number is executed sooner
  PLUGIN_ENABLED=0
  PLUGIN_DISABLED=86
  PLUGIN_SUBSTITUTIONS_FILE=PLUGIN_SUBSTITION_DIR/$PLUGIN_NAME.env
}

log() { echo "$PLUGIN_NAME: $@"; }

abort() {
  log "ABORT: $1" > /dev/stderr
  exit 1
}


main() {
  if [ $# != 1 ]; then abort "No command specified"; fi
  LIFECYCLE=$1
  on-$LIFECYCLE
  exit $?
}

# Normal flow
on-activate() { return $PLUGIN_DISABLED; }
on-priority() { echo $PLUGIN_PRIORITY; }
on-initialize() { return 0; }
on-validate() { return 0; }
on-before-deploy() { return 0; }
on-undeploy() { return 0; }
# <-- Future AZ lifecycles here
on-deploy() { return 0; }
on-verify-deploy() { return 0; }
on-after-deploy() { return 0; }
on-finalize() { return 0; }

# Rollback flow
on-before-rollback() { return 0; }
# <-- Future AZ rollback lifecycles here
on-rollback() { return 0; }
on-verify-rollback() { return 0; }
on-after-rollback() { return 0; }


_init
